SELECT
    -- Дата поездки для группировки
    date,

    -- Общее количество поездок за дату
    COUNT(*) AS trips,

    -- Максимальная стоимость поездки за дату
    MAX(price_rub) AS max_price_rub,

    -- Средняя дистанция поездки в километрах
    AVG(distance_m) / 1000 AS avg_distance_km,

    -- Средняя стоимость минуты поездки в рублях
    -- Рассчитывается как: (средняя цена / средняя длительность) * 60 секунд
    AVG(price_rub) / AVG(duration_s) * 60 AS avg_price_rub_per_min

FROM
    {{ ref("trips_prep") }}

-- Группируем по дате для получения дневной статистики
GROUP BY
    date

-- Сортируем по дате в хронологическом порядке
ORDER BY
    date
